================================================================================
                    烟火漫游 - 详细开发计划
================================================================================

【团队分工】
  后端开发：你    |    前端开发：同学    |    数据获取/处理：两人协作

【标注样本城市】（共10个）
  南京市鼓楼区、玉林市玉州区、成都市武侯区、武汉市武昌区、西安市长安区
  杭州市萧山区、广州市花都区、佛山市顺德区、温州市龙湾区、延边州延吉市

【技术选型】
  前端：Vue 3 + Vite + Element Plus + TailwindCSS + Mapbox GL + ECharts + Pinia
  后端：Python FastAPI + SQLAlchemy 2.0 + PostgreSQL + PostGIS + Redis + Celery
  数据：高德API/大众点评爬虫(待定) + NASA VIIRS夜光 + 通义千问API
  分析：GeoPandas + PySAL + OR-Tools + SnowNLP


================================================================================
【阶段零】环境搭建与项目初始化
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务0.1 后端环境搭建                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  1. 安装 Python 3.11+                                             ┃
┃  2. 创建虚拟环境 python -m venv venv                              ┃
┃  3. 安装依赖：fastapi uvicorn sqlalchemy psycopg2-binary等        ┃
┃  4. 初始化项目结构（见下方）                                       ┃
┃  5. 配置CORS允许前端跨域                                          ┃
┃  6. 创建健康检查接口 GET /api/health                              ┃
┃  7. 安装PostgreSQL + PostGIS扩展                                  ┃
┃  8. 安装Redis                                                     ┃
┃                                                                    ┃
┃【后端项目结构】                                                    ┃
┃  backend/                                                          ┃
┃  ├── app/                                                          ┃
┃  │   ├── main.py           # FastAPI入口                          ┃
┃  │   ├── config.py         # 配置                                 ┃
┃  │   ├── database.py       # 数据库连接                           ┃
┃  │   ├── models/           # SQLAlchemy模型                       ┃
┃  │   ├── schemas/          # Pydantic模式                         ┃
┃  │   ├── api/              # API路由                              ┃
┃  │   ├── services/         # 业务逻辑                             ┃
┃  │   └── utils/            # 工具函数                             ┃
┃  ├── scripts/              # 数据处理脚本                         ┃
┃  ├── requirements.txt                                              ┃
┃  └── .env                                                          ┃
┃                                                                    ┃
┃【达到效果】                                                        ┃
┃  ✓ http://localhost:8000/api/health 返回 {"status":"ok"}          ┃
┃  ✓ http://localhost:8000/docs 显示Swagger文档                     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务0.2 前端环境搭建                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【前端任务】                                                        ┃
┃  1. 安装 Node.js 18+                                              ┃
┃  2. npm create vite@latest frontend -- --template vue             ┃
┃  3. 安装依赖：element-plus tailwindcss axios pinia vue-router     ┃
┃  4. 安装 mapbox-gl echarts                                        ┃
┃  5. 配置vite.config.js代理到后端                                  ┃
┃  6. 创建基础布局组件                                               ┃
┃                                                                    ┃
┃【前端项目结构】                                                    ┃
┃  frontend/                                                         ┃
┃  ├── src/                                                          ┃
┃  │   ├── api/              # 接口封装                             ┃
┃  │   ├── components/       # 组件                                 ┃
┃  │   ├── views/            # 页面                                 ┃
┃  │   ├── stores/           # Pinia状态                            ┃
┃  │   ├── router/           # 路由                                 ┃
┃  │   └── utils/            # 工具                                 ┃
┃  ├── package.json                                                  ┃
┃  └── vite.config.js                                                ┃
┃                                                                    ┃
┃【达到效果】                                                        ┃
┃  ✓ npm run dev 启动成功                                           ┃
┃  ✓ 能调用后端health接口                                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务0.3 前后端联调测试                                            ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【验收标准】                                                        ┃
┃  ✓ 前端页面显示"后端连接成功"                                     ┃
┃  ✓ 控制台无跨域错误                                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛


================================================================================
【阶段一】数据底座建设
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.1 数据库设计与创建                                          ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】创建以下10张核心数据表                                  ┃
┃                                                                    ┃
┃ 1. districts (行政区划表)                                         ┃
┃    id | code | name | level | parent_code | center | boundary      ┃
┃                                                                    ┃
┃ 2. pois (POI店铺表)                                               ┃
┃    id | source_id | source | name | category | sub_category        ┃
┃    address | district_code | location(geometry) | phone            ┃
┃    business_hours | avg_price | rating | review_count              ┃
┃    open_date | is_chain | is_local | created_at | updated_at       ┃
┃                                                                    ┃
┃ 3. reviews (评论表)                                               ┃
┃    id | poi_id | content | rating | sentiment | review_time        ┃
┃                                                                    ┃
┃ 4. grids (网格单元表)                                             ┃
┃    id | grid_code | district_code | boundary | center              ┃
┃                                                                    ┃
┃ 5. vitality_scores (烟火气指数表)                                 ┃
┃    id | grid_id | district_code | total_score                      ┃
┃    business_score | night_score | popularity_score | local_score   ┃
┃    cluster_type | nightlight_value | calc_time                     ┃
┃                                                                    ┃
┃ 6. users (用户表)                                                 ┃
┃    id | username | email | password_hash | nickname | avatar       ┃
┃                                                                    ┃
┃ 7. exploration_routes (探索路线表)                                ┃
┃    id | user_id | name | description | district_code               ┃
┃    route_type | duration | distance | waypoints(jsonb) | is_public ┃
┃                                                                    ┃
┃ 8. footprints (足迹打卡表)                                        ┃
┃    id | user_id | poi_id | location | address                      ┃
┃    note | rating | photos(jsonb) | check_time                      ┃
┃                                                                    ┃
┃ 9. travelogs (游记表)                                             ┃
┃    id | user_id | route_id | title | content | cover_image         ┃
┃    style | is_ai_generated | is_public | view_count | like_count   ┃
┃                                                                    ┃
┃ 10. nightlight_data (夜光数据表)                                  ┃
┃    id | grid_id | year | avg_radiance | max_radiance               ┃
┃                                                                    ┃
┃【达到效果】所有表创建成功，PostGIS空间索引就绪                     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.2 行政区划数据导入                                          ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【数据获取】                                                        ┃
┃  来源：高德行政区划API 或 国家统计局数据                           ┃
┃  内容：全国34省、333地级市、约2850县级区划                         ┃
┃                                                                    ┃
┃【数据处理】                                                        ┃
┃  1. 解析JSON，提取code/name/center坐标                            ┃
┃  2. 构建parent_code层级关系                                       ┃
┃  3. 导入districts表                                               ┃
┃                                                                    ┃
┃【处理结果】districts表包含全国区划，可查层级关系                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.3 POI数据采集（10个样本区县）                               ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【采集范围】                                                        ┃
┃  10个样本区县（南京鼓楼/玉林玉州/成都武侯/武汉武昌/西安长安        ┃
┃              杭州萧山/广州花都/佛山顺德/温州龙湾/延边延吉）        ┃
┃                                                                    ┃
┃【采集类别】                                                        ┃
┃  餐饮：中餐/快餐/小吃/火锅/烧烤/咖啡/茶馆/酒吧                    ┃
┃  购物：便利店/超市/商场/菜市场/水果店                              ┃
┃  生活：美容美发/洗衣/宠物/药店                                     ┃
┃  娱乐：KTV/电影院/网吧/健身房                                      ┃
┃                                                                    ┃
┃【方案选择】（你们讨论后确定）                                      ┃
┃  方案A-高德API：覆盖全但无评论，约413元或30账号白嫖               ┃
┃  方案B-大众点评爬虫：有评论价格，免费但需处理反爬                  ┃
┃  方案C-混合：高德基础+点评补充，数据最全但工作量大                 ┃
┃                                                                    ┃
┃【数据处理】                                                        ┃
┃  1. 去重、清洗无效数据                                            ┃
┃  2. 坐标统一为WGS84                                               ┃
┃  3. 分类映射到统一体系                                            ┃
┃  4. 导入pois表                                                    ┃
┃                                                                    ┃
┃【处理结果】pois表含10区县数据，预计每县5000-20000条               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.4 评论数据采集                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【数据获取】大众点评爬虫                                            ┃
┃  每个POI采集前20-50条评论                                          ┃
┃  优先采集餐饮娱乐类（评论多）                                      ┃
┃                                                                    ┃
┃【数据处理】                                                        ┃
┃  1. 评论去重                                                      ┃
┃  2. 情感分析（SnowNLP或通义千问）                                 ┃
┃     - 计算每条评论情感分数：-1(负面) ~ 1(正面)                    ┃
┃  3. 提取评论时间，用于活跃度统计                                  ┃
┃                                                                    ┃
┃【处理结果】reviews表含评论+情感分数                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.5 本地特色店铺标注与规则学习                                ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【人工标注】（你们两人完成）                                        ┃
┃  1. 我生成Excel，列出10区县POI                                    ┃
┃  2. 你们判断是否"本地特色"，打勾标记                              ┃
┃  3. 标注标准：                                                    ┃
┃     ✓ 非连锁品牌                                                  ┃
┃     ✓ 地方特色（小吃、本地菜）                                    ┃
┃     ✓ 老字号                                                      ┃
┃     ✓ 评论有"正宗""本地人推荐"                                    ┃
┃  4. 每区县标注200-500个样本                                       ┃
┃                                                                    ┃
┃【规则学习】（我来完成）                                            ┃
┃  1. 分析标注数据，提取规则：                                      ┃
┃     - 店名特征词："老"、"记"、地名、方言                          ┃
┃     - 品类特征：小吃、早餐、本地菜                                ┃
┃     - 评论关键词："正宗""地道""老店"                              ┃
┃  2. 用规则自动标注剩余POI                                         ┃
┃  3. 更新pois表的is_local字段                                      ┃
┃                                                                    ┃
┃【处理结果】得到可复用的本地特色识别规则                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.6 夜光遥感数据处理                                          ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【数据获取】                                                        ┃
┃  来源：NASA VIIRS夜光数据（免费）                                  ┃
┃  网址：https://eogdata.mines.edu/products/vnl/                     ┃
┃  下载：2023年度合成 + 2015/2020历史数据（趋势分析用）              ┃
┃                                                                    ┃
┃【数据处理】                                                        ┃
┃  1. Rasterio读取GeoTIFF                                           ┃
┃  2. 裁剪10个样本区县范围                                          ┃
┃  3. 与500m网格对齐                                                ┃
┃  4. 计算每网格：平均辐射值、最大辐射值                            ┃
┃  5. 多年对比计算变化趋势                                          ┃
┃                                                                    ┃
┃【处理结果】                                                        ┃
┃  - nightlight_data表含各网格夜光值                                ┃
┃  - 可用于：指标计算、夜光底图、趋势分析                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.7 空间网格划分                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【数据处理】                                                        ┃
┃  1. 获取每个区县边界范围                                          ┃
┃  2. 创建500m×500m网格覆盖整个区县                                 ┃
┃  3. 为每个网格生成唯一grid_code                                   ┃
┃  4. 计算网格中心点                                                ┃
┃  5. 写入grids表                                                   ┃
┃                                                                    ┃
┃【处理结果】grids表含所有分析网格                                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.8 烟火气指数计算                                            ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】为每个网格计算指标                                      ┃
┃                                                                    ┃
┃ 业态丰富度(25分)                                                  ┃
┃   ├─ 餐饮密度(10)：网格餐饮POI数/面积                             ┃
┃   ├─ 业态多样性(10)：Shannon指数 = -Σ(pi×ln(pi))                  ┃
┃   └─ 本地特色占比(5)：is_local=true比例                           ┃
┃                                                                    ┃
┃ 夜间活力(25分)                                                    ┃
┃   ├─ 夜间营业比例(10)：20点后营业店铺占比                         ┃
┃   ├─ 深夜营业比例(5)：24点后营业店铺占比                          ┃
┃   └─ 夜光强度(10)：VIIRS辐射值归一化                              ┃
┃                                                                    ┃
┃ 人气热度(25分)                                                    ┃
┃   ├─ 评论总量(10)：网格内POI评论总数                              ┃
┃   ├─ 近期活跃度(10)：近3月新增评论数                              ┃
┃   └─ 情感倾向(5)：平均情感分数                                    ┃
┃                                                                    ┃
┃ 生活气息(25分)                                                    ┃
┃   ├─ 价格亲民度(10)：人均消费中位数（越低越高分）                 ┃
┃   ├─ 老店比例(10)：开业3年以上占比                                ┃
┃   └─ 本地特色占比(5)：同上                                        ┃
┃                                                                    ┃
┃【聚类分析】K-Means识别街区类型                                     ┃
┃   美食型 | 夜生活型 | 文艺型 | 生活型 | 综合型                    ┃
┃                                                                    ┃
┃【处理流程】                                                        ┃
┃  1. 空间关联：POI→网格                                            ┃
┃  2. 统计各项原始指标                                              ┃
┃  3. Min-Max归一化到0-100                                          ┃
┃  4. 加权求和得综合分                                              ┃
┃  5. K-Means聚类                                                   ┃
┃  6. 写入vitality_scores表                                         ┃
┃                                                                    ┃
┃【处理结果】每网格有完整烟火气评分+街区类型                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务1.9 烟火气数据API开发                                         ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】开发以下API                                             ┃
┃                                                                    ┃
┃  GET  /api/districts                 行政区划列表                 ┃
┃  GET  /api/districts/{code}/vitality 区县烟火气概况               ┃
┃  GET  /api/vitality/grids            网格烟火气数据(支持bbox)     ┃
┃  GET  /api/vitality/heatmap          热力图数据(按zoom级别)       ┃
┃  GET  /api/vitality/ranking          烟火气排行榜                 ┃
┃  GET  /api/pois                      POI列表(位置/分类/评分筛选)  ┃
┃  GET  /api/pois/{id}                 POI详情                      ┃
┃                                                                    ┃
┃【前端任务】此阶段可开始开发地图基础组件                           ┃
┃                                                                    ┃
┃【达到效果】API能正确返回数据，Swagger文档完整                     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛


================================================================================
【阶段二】核心功能开发
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.1 用户系统                                                  ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  POST /api/users/register      用户注册                           ┃
┃  POST /api/users/login         用户登录(返回JWT)                  ┃
┃  GET  /api/users/me            获取当前用户                       ┃
┃  PUT  /api/users/me            更新用户信息                       ┃
┃  PUT  /api/users/me/password   修改密码                           ┃
┃  - JWT认证中间件                                                  ┃
┃  - 密码bcrypt加密                                                 ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 登录页面                                                       ┃
┃  - 注册页面                                                       ┃
┃  - 个人中心页面                                                   ┃
┃  - Pinia全局登录状态管理                                          ┃
┃  - Axios拦截器自动添加token                                       ┃
┃  - 401响应跳转登录                                                ┃
┃                                                                    ┃
┃【达到效果】用户能注册登录，登录态全局管理                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.2 烟火气地图展示                                            ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  GET /api/vitality/heatmap     热力图数据(按zoom返回不同粒度)     ┃
┃  GET /api/vitality/grids/{id}  网格详情(评分+TOP POI+评论)        ┃
┃  GET /api/vitality/animation   时间动画数据(早/中/晚/深夜4帧)     ┃
┃  GET /api/nightlight/tiles     夜光瓦片数据                       ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - Mapbox地图初始化                                               ┃
┃  - 热力图图层：蓝(低)→黄→红(高)                                   ┃
┃  - 缩放联动：zoom变化切换数据粒度                                 ┃
┃  - 图层切换：综合/业态/夜间/人气/生活气息                         ┃
┃  - 夜光视图模式（切换底图）                                       ┃
┃  - 街区点击详情卡片：                                             ┃
┃    ├─ 综合评分(大字)                                              ┃
┃    ├─ 四维雷达图(ECharts)                                         ┃
┃    ├─ TOP5 POI列表                                                ┃
┃    ├─ 精选评论                                                    ┃
┃    └─ "开始探索"按钮                                              ┃
┃  - 时间滑块(早/中/晚/深夜)                                        ┃
┃  - 时间动画播放(一天活力变化动画)                                 ┃
┃  - 筛选面板(类型/评分)                                            ┃
┃  - 排行榜面板                                                     ┃
┃  - 城市选择器                                                     ┃
┃                                                                    ┃
┃【达到效果】                                                        ┃
┃  - 地图展示全国烟火气热力分布                                     ┃
┃  - 点击区域显示详情                                               ┃
┃  - 可切换图层和夜光视图                                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.3 智能路线规划                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  POST /api/routes/generate     智能生成路线                       ┃
┃    输入：location, duration, preference, budget                   ┃
┃    处理：                                                         ┃
┃      1. 查询附近高烟火气POI                                       ┃
┃      2. 按偏好筛选类型                                            ┃
┃      3. TSP算法优化游览顺序(OR-Tools)                             ┃
┃      4. 调用高德API计算路径                                       ┃
┃    输出：POI列表+路径polyline+时长+距离+预算                      ┃
┃                                                                    ┃
┃  POST   /api/routes            保存路线                           ┃
┃  GET    /api/routes            我的路线列表                       ┃
┃  GET    /api/routes/{id}       路线详情                           ┃
┃  PUT    /api/routes/{id}       更新路线                           ┃
┃  DELETE /api/routes/{id}       删除路线                           ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 路线规划页面                                                   ┃
┃  - 规划条件表单：                                                 ┃
┃    ├─ 位置选择(地图点选/搜索/定位)                                ┃
┃    ├─ 时间选择(2小时/半天/一天)                                   ┃
┃    ├─ 偏好选择(美食/文艺/夜生活/综合)                             ┃
┃    └─ 预算输入(可选)                                              ┃
┃  - 主题路线模板选择                                               ┃
┃  - 路线结果展示：                                                 ┃
┃    ├─ 地图路线可视化                                              ┃
┃    ├─ POI列表(可拖拽排序)                                         ┃
┃    └─ 每个POI详情卡片                                             ┃
┃  - 路线调整：添加/删除POI，拖拽排序                               ┃
┃  - 保存路线、我的路线列表                                         ┃
┃                                                                    ┃
┃【达到效果】输入条件生成路线，可调整并保存                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.4 首页与导航                                                ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【前端任务】                                                        ┃
┃  - 首页设计：                                                     ┃
┃    ├─ 顶部搜索栏(城市搜索)                                        ┃
┃    ├─ 快捷入口(地图/规划/足迹/社区)                               ┃
┃    ├─ 热门城市推荐                                                ┃
┃    ├─ 热门路线推荐                                                ┃
┃    └─ 精选游记                                                    ┃
┃  - 底部导航栏(移动端)                                             ┃
┃  - 侧边导航栏(桌面端)                                             ┃
┃  - 响应式布局适配                                                 ┃
┃                                                                    ┃
┃【达到效果】首页美观，功能入口清晰，双端适配                       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.5 城市发展趋势（夜光时序分析）                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  GET /api/nightlight/trend       夜光趋势数据(多年对比)           ┃
┃    输入：district_code, years=[2015,2020,2024]                    ┃
┃    输出：各年份网格夜光值、变化率、趋势类型                       ┃
┃                                                                    ┃
┃  GET /api/vitality/trend         烟火气变化趋势                   ┃
┃    输出：近期烟火气指数变化、预测趋势                             ┃
┃                                                                    ┃
┃【数据处理】                                                        ┃
┃  - 下载2015/2020/2024年NASA VIIRS数据                             ┃
┃  - 计算各网格夜光变化率                                           ┃
┃  - 识别"崛起中"(增长>30%)和"衰落中"(下降>20%)街区                 ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 趋势分析页面                                                   ┃
┃  - 时间轴选择器(2015/2020/2024)                                   ┃
┃  - 变化热力图(红=增长/蓝=下降)                                    ┃
┃  - 趋势动画播放(年份切换动画)                                     ┃
┃  - 崛起/衰落街区列表                                              ┃
┃  - 单街区历史曲线图                                               ┃
┃                                                                    ┃
┃【达到效果】可视化城市发展变迁，发现潜力街区                       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务2.6 街区/城市对比功能                                         ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  POST /api/compare/grids         街区对比                         ┃
┃    输入：grid_ids=[id1, id2, id3]（最多3个）                      ┃
┃    输出：各街区完整数据、各维度对比                               ┃
┃                                                                    ┃
┃  POST /api/compare/districts     城市(区县)对比                   ┃
┃    输入：district_codes=[code1, code2, code3]                     ┃
┃    输出：各区县汇总数据、排名、特色对比                           ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 对比页面入口                                                   ┃
┃  - 对比对象选择器(地图点选/搜索选择)                              ┃
┃  - 多维雷达图对比(ECharts)                                        ┃
┃  - 各指标柱状图对比                                               ┃
┃  - TOP店铺对比列表                                                ┃
┃  - 对比结论自动生成(文字描述)                                     ┃
┃                                                                    ┃
┃【达到效果】2-3个街区/城市PK，直观对比优劣                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛


================================================================================
【阶段三】记录与分享功能
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务3.1 探索打卡功能                                              ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  POST   /api/footprints        创建打卡                           ┃
┃  GET    /api/footprints        打卡列表                           ┃
┃  GET    /api/footprints/{id}   打卡详情                           ┃
┃  DELETE /api/footprints/{id}   删除打卡                           ┃
┃  GET    /api/footprints/stats  足迹统计                           ┃
┃  GET    /api/footprints/diary  探索日记(按日期聚合)               ┃
┃  GET    /api/footprints/track  轨迹数据(用于回放)                 ┃
┃  POST   /api/upload/image      图片上传                           ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 打卡页面：                                                     ┃
┃    ├─ 定位当前位置                                                ┃
┃    ├─ 附近POI推荐                                                 ┃
┃    ├─ 照片上传                                                    ┃
┃    ├─ 心情记录                                                    ┃
┃    └─ 评价选择(值得来/一般/踩雷)                                  ┃
┃  - 足迹地图(显示所有打卡点)                                       ┃
┃  - 足迹时间线                                                     ┃
┃  - 足迹统计展示(城市数/点位数/里程)                               ┃
┃  - 探索日记(每日足迹自动聚合、照片整理、消费记录)               ┃
┃  - 轨迹回放动画(地图上回放某次探索路线+照片定位)             ┃
┃                                                                    ┃
┃【达到效果】能打卡记录，查看足迹，日记聚合，轨迹回放             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务3.2 AI游记生成                                                ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  POST /api/travelogs/generate  AI生成游记                         ┃
┃    输入：route_id 或 footprint_ids, style                         ┃
┃    处理：                                                         ┃
┃      1. 收集路线/足迹数据                                         ┃
┃      2. 构造Prompt                                                ┃
┃      3. 调用通义千问API                                           ┃
┃    输出：生成的游记内容(Markdown)                                 ┃
┃                                                                    ┃
┃  POST   /api/travelogs         保存游记                           ┃
┃  GET    /api/travelogs         游记列表                           ┃
┃  GET    /api/travelogs/{id}    游记详情                           ┃
┃  PUT    /api/travelogs/{id}    更新游记                           ┃
┃  DELETE /api/travelogs/{id}    删除游记                           ┃
┃  POST   /api/travelogs/export  导出游记(长图/小红书格式)         ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 游记生成页(选择路线/足迹，选择风格)                            ┃
┃  - 游记编辑器(Markdown，图片插入，AI重写段落)                    ┃
┃  - 游记预览                                                       ┃
┃  - 导出功能：                                                     ┃
┃    ├─ 长图导出(朋友圈/微博)                                      ┃
┃    ├─ 小红书格式                                                  ┃
┃    └─ 分享链接                                                    ┃
┃                                                                    ┃
┃【达到效果】一键生成游记，可编辑，多格式导出                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务3.3 探索社区                                                  ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  GET    /api/community/travelogs  公开游记列表                    ┃
┃  GET    /api/community/routes     公开路线列表                    ┃
┃  POST   /api/likes                点赞                            ┃
┃  DELETE /api/likes/{id}           取消点赞                        ┃
┃  POST   /api/favorites            收藏                            ┃
┃  POST   /api/comments             评论                            ┃
┃  POST   /api/routes/copy/{id}     复制路线                        ┃
┃  POST   /api/discoveries         提交隐藏点位                      ┃
┃  GET    /api/discoveries         隐藏点位列表(待验证/已通过)        ┃
┃  POST   /api/discoveries/{id}/vote  点位验证投票               ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 社区首页(游记瀑布流，路线列表)                                 ┃
┃  - 游记详情页(公开版)                                             ┃
┃  - 路线详情页(公开版)                                             ┃
┃  - 互动功能(点赞/收藏/评论)                                       ┃
┃  - 复制路线功能                                                   ┃
┃  - 隐藏点位贡献：                                                 ┃
┃    ├─ 提交新发现点位(位置/照片/描述)                            ┃
┃    ├─ 社区验证投票(3人通过即收录)                              ┃
┃    └─ 贡献积分展示                                                ┃
┃                                                                    ┃
┃【达到效果】浏览互动，复制路线，贡献隐藏宝藏点                     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛


================================================================================
【阶段四】优化与封装
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务4.1 UI美化                                                    ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【前端任务】                                                        ┃
┃  - 统一设计风格和色彩                                             ┃
┃  - 动画效果优化                                                   ┃
┃  - 加载状态优化(骨架屏)                                           ┃
┃  - 空状态设计                                                     ┃
┃  - 错误状态设计                                                   ┃
┃  - 响应式适配检查                                                 ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务4.2 性能优化                                                  ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  - 接口响应缓存(Redis)                                            ┃
┃  - 数据库查询优化                                                 ┃
┃  - 空间索引优化                                                   ┃
┃  - 分页优化                                                       ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - 图片懒加载                                                     ┃
┃  - 组件懒加载                                                     ┃
┃  - 地图数据按需加载                                               ┃
┃  - 请求防抖节流                                                   ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务4.3 APP封装                                                   ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【前端任务】                                                        ┃
┃  桌面端(Electron)：                                               ┃
┃    - 安装electron electron-builder                                ┃
┃    - 配置main.js                                                  ┃
┃    - 打包Windows/Mac安装包                                        ┃
┃                                                                    ┃
┃  移动端(Capacitor)：                                              ┃
┃    - npm install @capacitor/core @capacitor/cli                   ┃
┃    - npx cap init                                                 ┃
┃    - npx cap add android                                          ┃
┃    - 用Android Studio打包APK                                      ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 任务4.4 部署上线                                                  ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃【后端任务】                                                        ┃
┃  - Dockerfile编写                                                 ┃
┃  - docker-compose配置                                             ┃
┃  - 生产环境变量配置                                               ┃
┃  - 部署到服务器                                                   ┃
┃                                                                    ┃
┃【前端任务】                                                        ┃
┃  - npm run build 构建生产版本                                     ┃
┃  - Nginx配置                                                      ┃
┃  - HTTPS证书配置                                                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛


================================================================================
【任务依赖关系】
================================================================================

阶段零(并行) → 阶段一(依次) → 阶段二(部分并行) → 阶段三 → 阶段四

详细依赖：
┌─────────────────────────────────────────────────────────────────────┐
│ 0.1后端环境 ─┐                                                      │
│              ├→ 0.3联调 → 1.1数据库 → 1.2区划 ─┐                   │
│ 0.2前端环境 ─┘                                  │                   │
│                                                 ↓                   │
│                        1.3 POI采集 → 1.4评论 → 1.5标注 ─┐          │
│                              ↓                          │          │
│                        1.6夜光处理                      │          │
│                              ↓                          ↓          │
│                        1.7网格划分 ────────────→ 1.8指数计算       │
│                                                         ↓          │
│                                                   1.9烟火气API      │
│                                                         ↓          │
│                        ┌────────────────────────────────┘          │
│                        ↓                                            │
│                   2.1用户系统(后端) ←──→ 2.1用户系统(前端)         │
│                        ↓                       ↓                   │
│                   2.2地图API ←────────→ 2.2烟火气地图              │
│                        ↓                       ↓                   │
│                   2.3路线API ←────────→ 2.3路线规划                │
│                                                ↓                   │
│                                           2.4首页导航              │
│                                                ↓                   │
│                   3.1打卡API ←────────→ 3.1打卡功能                │
│                   3.2游记API ←────────→ 3.2AI游记                  │
│                   3.3社区API ←────────→ 3.3探索社区                │
│                                                ↓                   │
│                                      4.1美化 → 4.2优化 → 4.3封装   │
└─────────────────────────────────────────────────────────────────────┘


================================================================================
【文档结束】开发计划_详细版.txt
================================================================================
