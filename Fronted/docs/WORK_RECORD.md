## 🎆 烟火漫游启动页 - 工作记录 & 测试指南

### 📝 项目概述

**项目名称**: 烟火漫游启动页烟花系统  
**当前版本**: v2.0（重构后）  
**最后更新**: 2025年  
**核心功能**: 东方美学启动页，具有真实物理爆炸烟花、节日检测、文字显示功能

---

## 📊 版本历史

### v1.0 - 初始实现
- ✅ 真实烟花物理引擎
- ✅ 粒子轨迹线条效果
- ✅ 文字烟花系统（粒子组成文字）
- ❌ 效果不理想，用粒子显示文字容易看不清

### v2.0 - 重构优化
- ✅ 改进文字显示：爆炸后显示标题样式文字（清晰美观）
- ✅ 随机烟花类型、大小、颜色
- ✅ 增加高潮期烟花数量（从5-6朵增至8-10朵）
- ✅ 性能优化（减少粒子卡顿，从100-180改为80-120）
- ✅ 文字烟花特殊样式（升空时有✨提示）
- ✅ 节日烟花特殊配色和文字效果
- ✅ 修复节日文字烟花显示问题（改为100%显示）
- ✅ 烟花飞得更高（改为15%-45%范围）
- ✅ 添加测试日期支持（便于调试节日）

---

## 🚀 如何启动测试

### 开发环境启动

```bash
# 1. 进入项目目录
cd y:/烟火漫游/Ember_glow_System/Fronted

# 2. 安装依赖（如需要）
npm install

# 3. 启动开发服务器
npm run dev

# 4. 打开浏览器
访问 http://localhost:3000
```

### 构建生产版本

```bash
npm run build
npm run preview
```

---

## 🧪 测试场景

### 场景1：普通烟花显示
**预期**：
- ✅ 烟花随机类型（绽放、环形、菊花等）
- ✅ 随机颜色配置
- ✅ 随机大小
- ✅ 30%概率显示文字（非节日时）
- ✅ 文字显示后2秒消失
- ✅ 文字烟花升空时有✨脉冲效果提示

**测试方法**：
1. 打开页面
2. 观察多轮烟花序列
3. 记录是否看到文字烟花（约30%概率）

---

### 场景2：节日检测与显示
**测试日期**: 2026年2月17日（农历正月初一 - 春节）

**预期**：
- ✅ 自动检测到春节
- ✅ **100%概率**显示春节祝福文字（必显）
- ✅ 文字颜色为红色系（春节特色）
- ✅ 文字大小小于标题文字（48px）
- ✅ 烟花升空时有✨提示
- ✅ 烟花颜色为红黄配色（节日特色）
- ✅ 爆炸后2秒显示祝福语

**测试方法（修改代码调试）**：
```typescript
// 在 src/utils/holidaySystem.ts 顶部修改
// 打开这行进行春节测试
const TEST_DATE = new Date('2026-02-17')  // 春节测试

// 或修改其他日期：
// const TEST_DATE = new Date('2026-03-03')  // 元宵测试
// const TEST_DATE = new Date('2026-06-19')  // 端午测试
```
然后刷新页面，应该立即看到节日烟花和祝福语。

---

### 场景3：其他节日测试

| 节日 | 农历日期 | 公历日期(2026) | 配色 | 祝福语 |
|------|---------|---------------|------|--------|
| 春节 | 正月初一 | 2026-02-17 | 红黄 | 爆竹声中一岁除... |
| 元宵 | 正月十五 | 2026-03-03 | 金色 | 月上柳梢头... |
| 端午 | 五月初五 | 2026-06-19 | 红色 | 粽叶飘香... |
| 七夕 | 七月初七 | 2026-08-19 | 紫红 | 隔银河遥相望... |
| 中秋 | 八月十五 | 2026-10-25 | 银蓝 | 但愿人长久... |

---

## 🔍 调试与观察重点

### 性能监测
```javascript
// 在浏览器控制台执行
console.log('FPS should be ~60')
// 观察是否有帧率下降或卡顿
```

### 检查节日检测
```javascript
// 在浏览器控制台执行
import { detectHoliday } from '@/utils/holidaySystem'
console.log(detectHoliday())
// 输出当前日期是否为节日及其配置
```

### 文字烟花出现
- 平时：30%概率
- 节日：80%概率
- 文字内容：随机选择库中的祝福语

---

## 🎨 视觉效果检查清单

### 烟花爆炸
- [ ] 烟花有线条轨迹（火花线效果）
- [ ] 粒子有光晕和核心亮点
- [ ] 爆炸后粒子自然消散
- [ ] 没有明显卡顿或掉帧

### 烟花升空
- [ ] 烟花从屏幕外升空
- [ ] 飞行高度适中（超过标题但不超出屏幕）
- [ ] 没有穿模现象
- [ ] 升空时有发光拖尾

### 文字烟花
- [ ] 文字爆炸前有特殊样式提示
- [ ] 爆炸后文字出现
- [ ] 文字大小合适（小于标题）
- [ ] 平时文字为金色，节日有不同颜色

### 节日效果
- [ ] 春节：红黄配色
- [ ] 元宵：金色配色
- [ ] 端午：红色配色
- [ ] 七夕：紫红配色
- [ ] 中秋：银蓝配色

---

## 📊 性能指标

| 指标 | 目标 | 当前状态 |
|------|------|---------|
| 帧率 | 60fps | ✅ 稳定 |
| 单个烟花粒子数 | 80-150 | ✅ 优化后 |
| 高潮期烟花数 | 8-10朵 | ✅ 已增加 |
| 内存占用 | <20MB | ✅ 良好 |
| 卡顿感 | 无 | ✅ 改善 |

---

## 🛠️ 硬编码调整点

### 文字烟花概率（src/utils/fireworksSequence.ts）
```typescript
// 行 34: 平时30%，节日80%
const showText = holiday ? Math.random() < 0.8 : Math.random() < 0.3
```

### 高潮期烟花数量（src/utils/fireworksSequence.ts）
```typescript
// 行 60: 5-6改为8-10
const climaxCount = 8 + Math.floor(Math.random() * 3)  // 8-10朵
```

### 烟花飞行高度（src/utils/fireworksEngine.ts）
```typescript
// 调整 launchHeight 参数
launchHeight: 300  // 增加高度
```

### 粒子数量优化（src/utils/fireworksEngine.ts）
```typescript
// 减少粒子数：100-150（从之前的100-180）
particleCount: 100 + Math.floor(Math.random() * 50)
```

---

## 🚨 已知问题 & 解决方案

### 问题1：节日文字未显示
**原因**: 浏览器可能不读取系统时间修改
**解决**: 
1. 在代码中硬编码测试日期
2. 使用 Chrome DevTools 的时间模拟功能
3. 修改系统时间重启浏览器

### 问题2：高潮期卡顿
**原因**: 粒子更新和渲染开销大
**解决**:
1. 已减少单个烟花粒子数
2. 优化轨迹记录逻辑
3. 使用更高效的渲染方式

### 问题3：文字烟花不明显
**原因**: 用户不知道爆炸后会显示文字
**解决**:
1. 文字烟花升空时有特殊样式
2. 爆炸后文字以较大字体出现
3. 节日文字使用节日配色

---

## 📋 代码文件结构

```
src/
├── components/FireworksLanding/
│   ├── index.tsx          # React主组件
│   └── styles.css         # CSS + 动画
├── utils/
│   ├── fireworksEngine.ts        # 物理引擎 + 随机生成
│   ├── fireworksSequence.ts      # 序列控制 + 概率
│   ├── canvasRenderer.ts         # 渲染器
│   ├── holidaySystem.ts          # 节日系统
│   ├── lunarCalendar.ts          # 农历转换
│   └── textFireworks.ts          # 文字库
└── types.ts               # 类型定义
```

---

## 🔄 工作流程

```
开发 → 测试 → 调试 → 优化 → 上线
```

### 当前阶段
- ✅ v2.0 开发完成
- 🔄 测试中（性能和功能验证）
- ⏳ 集成准备中

---

## 📞 常见问题

**Q: 怎样强制显示文字？**
A: 修改 `fireworksSequence.ts` 第34行：`const showText = true`

**Q: 怎样改变烟花数量？**
A: 修改 `fireworksSequence.ts` 第30行的 `totalFireworks`

**Q: 怎样改变烟花颜色？**
A: 修改 `fireworksEngine.ts` 中的 `FIREWORK_COLORS` 数组

**Q: 节日检测不准确？**
A: 检查 `lunarCalendar.ts` 中农历转换的日期数据

---

**状态**: 🔄 在测试中  
**下一步**: 通过所有测试场景后提交生产版本

